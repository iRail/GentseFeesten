<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<html lang="nl" manifest="manifest.appcache">
	<head>
		<meta charset="utf-8" />

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

		<title>Gentse Feesten</title>
		<meta name="description" content="" />
		<meta name="author" content="Dimitri Roose" />
		<meta name="author" content="Pieter Colpaert" />
		<meta name="author" content="Tim Besard" />

		<!--[if lt IE 9]>
		    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		    <![endif]-->

		<!-- as not every OS supports HTML-less icon detection, provide this in details, and link to imgage dir instead of root -->
		
		<!-- 1. iPhone 4/retina --> 
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/gentsefeesten.png">
		<!-- iPad G1 -->
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/gentsefeesten.png">
		<!-- non-retina iPhone, iPod Touch, Android 2.1+ -->
		<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/gentsefeesten.png">
		<!-- everything else, provider higher resolution img -->
		<link rel="apple-touch-icon-precomposed" href="/gentsefeesten.png">
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
	
		<!-- CSS
		     ================================================== -->
		<link rel="stylesheet" href="css/base.css">
		<link rel="stylesheet" href="css/skeleton.css">
		<link rel="stylesheet" href="css/layout.css">
 
		<meta name="viewport" content="width=device-width; initial-scale=1.0" />
        
		<script src="js/modernizr-2.0.6-custom.min.js"></script>
		<script src="js/jquery-1.6.2.min.js"></script>
		<script src="js/gentsefeesten.js"></script>
		<script>

		//
		// Static data
		//
		
		var mHasLocation = false
		var mLatitude, mLongitude
		
		var mEvents
		
		var mRadius = 2
		
		var mCurrentEvent
		
		//
		// Auxiliary
		//
		
		function readableDistance(iMeters) {
			if (iMeters > 1000) {
				var tKilometers = iMeters/1000
				return Math.round(tKilometers*100)/100 + " km"
			}
			return Math.round(iMeters) + " m"
		}
		
		
		//
		// UI creation
		//
		
		function populateEventList() {
			// Filter the events
			var date = new Date();
			var tFilteredEvents = GentseFeesten.filterEvents(mEvents, date.getHours())
			
			// Populate the events (quite brute for now)
			var t = $('#events li.template')
			$.each(tFilteredEvents.upcoming, function(tPartitionIndex, tPartition) {
				if (tPartition.length > 0) {
					var tPartitionItem = $('#listDivider').clone();
					tPartitionItem.attr('id', 'divider_' + tPartitionIndex);
					$(".title", tPartitionItem).text((tPartitionIndex+date.getHours()) + " uur");
					$(".counter", tPartitionItem).text(tPartition.length + " events");
					tPartitionItem.appendTo($('#events'));
				
					$.each(tPartition, function (tEventIndex, tEvent) {
						var tEventItem = $('#item').clone();
						tEventItem.attr('id', 'event_' + tPartitionIndex + '_' + tEventIndex);
						$('#title', tEventItem).text(tEvent.title);
						$('#start', tEventItem).text(tEvent.schedule.start);
						$('.location .description', tEventItem).text(tEvent.location.description)
						$('a', tEventItem).attr('href', '#event');
						$('a', tEventItem).click( function() {
							mCurrentEvent = JSON.stringify(tEvent);
							populateEvent();
						});
						tEventItem.appendTo($('#events'));
					});
				}
			});
			$('#listDivider').remove();
			$('#item').remove();
			$('#events').attr("style", "")



//ook voor hele dag
if(tFilteredEvents.continuous.length < 0){
	$('#listDivider2').text("Niets gevonden");
				       
}
	$.each(tFilteredEvents.continuous, function(tPartitionIndex, tPartition) {
				if (tPartition.length > 0) {
					var tPartitionItem = $('#listDivider2').clone();
					tPartitionItem.attr('id', 'divider_' + tPartitionIndex);
					$(".title2", tPartitionItem).text((tPartitionIndex+date.getHours()) + " uur");
					$(".counter2", tPartitionItem).text(tPartition.length + " events");
					tPartitionItem.appendTo($('#events2'));
				
					$.each(tPartition, function (tEventIndex, tEvent) {
						var tEventItem = $('#item2').clone();
						tEventItem.attr('id', 'event_' + tPartitionIndex + '_' + tEventIndex);
						$('#title2', tEventItem).text(tEvent.title);
						$('#start2', tEventItem).text(tEvent.schedule.start);
						$('.location .description', tEventItem).text(tEvent.location.description)
						$('a', tEventItem).attr('href', '#event2');
						$('a', tEventItem).click( function() {
							mCurrentEvent = JSON.stringify(tEvent);
							populateEvent();
						});
						tEventItem.appendTo($('#events2'));
					});
				}
			});
			$('#listDivider2').remove();
			$('#item2').remove();
			$('#events2').attr("style", "")
		

		}
		
		function populateEvent() {
			if(mCurrentEvent) {
				$('#eventDetails').empty();
				var tCurrentEvent = $.parseJSON(mCurrentEvent);
				$('<h3>').text(tCurrentEvent.title).appendTo('#eventDetails');
				$('<p>').text(tCurrentEvent.description).appendTo('#eventDetails');
				$('<h4>').text('Locatie').appendTo('#eventDetails');
				$('<p>').text(tCurrentEvent.location.description).appendTo('#eventDetails');
				$('<h4>').text('Tijdstip').appendTo('#eventDetails');
				$('<p>').text('Van ' + tCurrentEvent.schedule.start + ' tot ' + tCurrentEvent.schedule.stop + '.').appendTo('#eventDetails');
			}
		}
		
		
		//
		// Main
		//
		
		$('document').ready(function() {
            // Check the appcache
            if (Modernizr.applicationCache) {
                window.applicationCache.addEventListener(
                    'updateready',
                    function(e) {
                        if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
                            // Browser downloaded a new app cache.
                            // Swap it in and reload the page to get the new hotness.
                            window.applicationCache.swapCache();
                            if (confirm('Der es een nieuwe versie beschikboar. Magk u browser herladen?')) {
                                window.location.reload();
                            }
                        } else {
                            // Manifest didn't changed. Nothing new to server.
                        }
                    },
                    false);
            }

			// Request the current location
			GentseFeesten.getLocation(
				function onLocationSuccess(iLatitude, iLongitude, iAccuracy) {
					mLatitude = iLatitude
					mLongitude = iLongitude
					mHasLocation = true
				},
				function (error) {
					mHasLocation = false
				}
			);
			
			// Request a list of events
			var date = new Date();
			GentseFeesten.getEvents(
				date.getDate() - 15,
				function(iEvents) {
					mEvents = iEvents	
					populateEventList();
				},
				function(error) {
					alert("Oeie, tmarcheert precies ni...");
			});
		});
	    </script>
	</head>
	<body>


	  <!-- Standard <ul> with class of "tabs" -->
	  <ul class="tabs">
	    <!-- Give href an ID value of corresponding "tabs-content" <li>'s -->
	    <li><a class="active" href="#tijd">Evenementen</a></li>
	    <li><a href="#hd">Vandaag hele dag</a></li>
	    <li><a href="#info">Over deze webapp</a></li>
	  </ul>

	  <ul class="tabs-content">
	    <li class="active" id="tijdTab">
	      <div class="container">
		<!-- Give column value in word form (one, two..., twelve) -->
		<div class="sixteen columns">
		  <h1>Evenementen voor de volgende 2 uur</h1>
		</div>	   
		<!-- Sweet nested columns cleared with a clearfix class -->
		<div class="twelve columns clearfix" id="events">
		  <div id="listDivider" class="twelve columns alpha">
		    <h2 class="title"></h2>
		    <span class="counter"></span>
		  </div>
		  <!-- In nested columns give the first column a class of alpha
		       and the second a class of omega -->
		  <div class="six columns alpha" id="item">
		    <strong id="start"></strong>
		    <h3 id="title"></h3>
		    <p>
		      <strong class="location" >
			<span class="description"> </span>
		      </strong>
		    </p>
		  </div>
		</div>
	      </div>
	    </li>
	    <li id="hdTab">
	      <div class="container">
		<!-- Give column value in word form (one, two..., twelve) -->
		<div class="sixteen columns">
		  <h1>Dag-informatie</h1>
		</div>	   
		<!-- Sweet nested columns cleared with a clearfix class -->
		<div class="twelve columns clearfix" id="events2">
		  <div id="listDivider2" class="twelve columns alpha">
		    <h2 class="title2"></h2>
		    <span class="counter2"></span>
		  </div>
		  <!-- In nested columns give the first column a class of alpha
		       and the second a class of omega -->
		  <div class="six columns alpha" id="item2">
		    <strong id="start2"></strong>
		    <h3 id="title2"></h3>
		    <p>
		      <strong class="location2" >
			<span class="description2"> </span>
		      </strong>
		    </p>
		  </div>
		</div>
	      </div>

	    </li>
	    <li id="infoTab">
<blockquote>
<p>
	      <ul>
		<li>Vertoald door <a href="http://www.twitter.com/BartRosseau" target="_blank">Bart Rosseau</a> - Ambtenaar 2.0</li>
		<li>Uitgewerkt tijdens <a href="http://www.summerofcode.be" target="_blank">iRail Summer of Code</a></li>
		<li>Open source: <a href="http://github.com/iRail/GentseFeesten/" target="_blank">broncode</a></li>
		<li>Auteurs:
		  <ul>
		    <li>Dimitri Roose - dimitri at iRail.be</li>
		    <li>Tim Besard - tim at iRail.be</li>
		    <li>Pieter Colpaert - pieter at iRail.be</li>
		</ul></li>
		<li>Met dank aan Stad Gent en iedereen die zijn steentje bijdroeg tot het openen van deze data</li>
	      </ul>
</p>
</blockquote>
	    </li>
	  </ul>
	  <blockquote>
	    <p id="eventDetails">


	    </p>
	    <cite>iRail vzw/asbl</cite>
	  </blockquote>

	  <div data-role="footer">
	    <p align="center">
	      <small>&copy; 2011 <a href="http://npo.iRail.be" target="_blank">iRail vzw/asbl</a> - Sommige rechten veurbehouden</small>
	    </p>
	  </div>

	  <script src="js/app.js"></script>
	</body>
</html>
